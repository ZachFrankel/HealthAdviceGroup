{% extends 'base.html' %}

{% block title %}Health Information{% endblock %}

{% block content %}
<div class="container py-5">
    <h1 class="mb-4" style="color: #3DA18C;">Health Information & Guidelines</h1>
    
    <div class="card shadow-sm">
        <div class="card-body" id="content-area">
            <div class="text-center py-4" id="loading-state">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h3 class="h4">Generating AI Information...</h3>
                <p class="text-muted">This may take a few moments</p>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async function() {
    try {
        const response = await fetch('/api/ai/generate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                prompt: `Generate a detailed health information page with the following sections:

                1. Seasonal Health Issues (with symptoms and preventions)
                2. General Health Tips (nutrition, exercise, mental health)
                3. Emergency Warning Signs

                Use this format for each section:
                [Section Title]
                [Subsection Title]:
                - [Key Point 1]
                - [Key Point 2]`
            })
        });

        const result = await response.json();
        if (result.success) {
            const contentArea = document.getElementById('content-area');
            const content = result.response.split('\n').map(line => {
                if (line.trim()) {
                    if (line.startsWith('#')) {
                        return `<h2 class="h3 mb-3 mt-4" style="color: #3DA18C;">${line.replace('#', '').trim()}</h2>`;
                    } else if (line.endsWith(':')) {
                        return `<h3 class="h5 mb-2 mt-3">${line}</h3>`;
                    } else if (line.startsWith('-')) {
                        return `<div class="mb-2 ps-3">${line}</div>`;
                    } else {
                        return `<p class="mb-2">${line}</p>`;
                    }
                }
                return '';
            }).join('');
            
            contentArea.innerHTML = content;
        } else {
            throw new Error('Failed to generate content');
        }
    } catch (error) {
        const contentArea = document.getElementById('content-area');
        contentArea.innerHTML = `
            <div class="alert alert-danger">
                Error loading health information. Please try again later.
            </div>
        `;
    }
});
</script>
{% endblock %}